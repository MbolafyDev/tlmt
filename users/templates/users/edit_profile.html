{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Modifier mon profil{% endblock %}

{% block content %}
<section class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
        
        <!-- Header -->
        <div class="bg-primary text-white text-center py-3">
          <h3 class="fw-bold mb-0">
            <i class="fa fa-user-edit me-2"></i> Modifier mon profil
          </h3>
        </div>

        <!-- Body -->
        <div class="card-body p-4 bg-white">
          <form method="POST" enctype="multipart/form-data" novalidate>
            {% csrf_token %}

            {% for field in form %}
              <div class="mb-4 form-row-with-icon">
                <label class="form-label fw-semibold mb-2">
                  <span class="label-dot"></span> {{ field.label }}
                </label>

                <div class="input-with-badge">
                  <div class="icon-circle">
                    {% if field.name == "username" %}
                      <i class="fa fa-user"></i>
                    {% elif field.name == "nom_complet" or "nom" in field.label|lower %}
                      <i class="fa fa-id-card"></i>
                    {% elif field.name == "email" %}
                      <i class="fa fa-envelope"></i>
                    {% elif field.name == "contact" %}
                      <i class="fa fa-phone"></i>
                    {% elif field.name == "adresse" %}
                      <i class="fa fa-map-marker-alt"></i>
                    {% elif field.name == "image" %}
                      <i class="fa fa-image"></i>
                    {% else %}
                      <i class="fa fa-edit"></i>
                    {% endif %}
                  </div>

                  {{ field|add_class:"form-control form-control-lg rounded-pill ps-5 pe-4 shadow-sm" }}
                </div>

                {% if field.errors %}
                  <div class="text-danger small mt-1">{{ field.errors|striptags }}</div>
                {% endif %}
              </div>
            {% endfor %}

            <button type="submit" class="btn btn-primary btn-lg w-100 rounded-pill shadow-sm">
              <i class="fa fa-save me-2"></i> Enregistrer les modifications
            </button>
          </form>
        </div>

        <!-- Footer -->
        <div class="card-footer text-center bg-white border-0 py-3">
          <a href="{% url 'profile' %}" class="text-decoration-none fw-semibold text-primary">
            <i class="fa fa-arrow-left me-1"></i> Retour Ã  mon profil
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Styles -->
<style>
.input-with-badge {
  position: relative;
  display: block;
}

.icon-circle {
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: #ffffff;
  border: 1px solid rgba(13,110,253,0.12);
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(13,110,253,0.06);
  color: #0d6efd;
  z-index: 2;
}

.icon-circle i {
  font-size: 15px;
}

.input-with-badge .form-control {
  padding-left: 56px !important;
  height: 52px;
  border-radius: 999px;
}

.input-with-badge input[type="file"].form-control {
  padding-left: 56px !important;
  padding-top: 10px;
  height: auto;
}

.label-dot {
  width: 10px;
  height: 10px;
  display: inline-block;
  background: #0d6efd;
  border-radius: 50%;
  margin-right: 10px;
  vertical-align: middle;
  box-shadow: 0 2px 6px rgba(13,110,253,0.18);
}

.form-control:focus {
  box-shadow: 0 8px 30px rgba(13,110,253,0.08);
  border-color: rgba(13,110,253,0.6);
  outline: none;
}

.card:hover {
  transform: translateY(-4px);
  transition: transform 220ms ease;
}

@media (max-width: 576px) {
  .icon-circle { left: 8px; width:34px; height:34px; }
  .input-with-badge .form-control { padding-left: 50px; height:48px; }
  .label-dot { width:8px; height:8px; margin-right:8px; }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('.icon-circle').forEach(function(badge) {
    badge.style.cursor = 'pointer';
    badge.addEventListener('click', function () {
      const wrapper = badge.closest('.input-with-badge');
      if (!wrapper) return;
      const input = wrapper.querySelector('.form-control');
      if (input) input.focus();
    });
  });
});
</script>

{% endblock %}
