{% extends "base.html" %}
{% load static %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
  <h1 class="dashboard-title text-center mb-4">ðŸ“Š Tableau de bord</h1>

  <!-- ====== CARTES PRINCIPALES ====== -->
  <div class="dashboard-cards">
    <div class="card dash-card">
      <div class="card-icon bg-warning"><i class="fas fa-shopping-cart"></i></div>
      <h3>Total Commandes</h3>
      <p>{{ total_commandes }}</p>
    </div>
    <div class="card dash-card">
      <div class="card-icon bg-primary"><i class="fas fa-money-bill-wave"></i></div>
      <h3>Total Ventes (Ar)</h3>
      <p>{{ total_ventes }}</p>
    </div>
    <div class="card dash-card">
      <div class="card-icon bg-success"><i class="fas fa-concierge-bell"></i></div>
      <h3>Total Services</h3>
      <p>{{ total_services }}</p>
    </div>
  </div>

  <hr class="divider">

  <!-- ====== GRAPHIQUES ====== -->
  <div class="charts-container">
    <div class="chart-box">
      <h2>Commandes par mode de paiement</h2>
      <canvas id="chartCommandes"></canvas>
    </div>
    <div class="chart-box">
      <h2>Services par statut</h2>
      <canvas id="chartServices"></canvas>
    </div>
  </div>
</div>

<!-- ====== SCRIPTS CHART.JS ====== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const commandesData = {{ commandes_par_mode|safe }};
  const labelsCommandes = commandesData.map(c => c.mode_paiement);
  const dataCommandes = commandesData.map(c => c.total);

  const ctxCommandes = document.getElementById('chartCommandes').getContext('2d');
  new Chart(ctxCommandes, {
    type: 'pie',
    data: {
      labels: labelsCommandes,
      datasets: [{
        data: dataCommandes,
        backgroundColor: ['#ffc107','#0d1b2a','#36a2eb','#4bc0c0','#9b59b6'],
        borderWidth: 1
      }]
    },
    options: {
      plugins: { legend: { position: 'bottom' } },
      responsive: true,
      maintainAspectRatio: false
    }
  });

  const ctxServices = document.getElementById('chartServices').getContext('2d');
  new Chart(ctxServices, {
    type: 'bar',
    data: {
      labels: ['PlanifiÃ©','En cours','TerminÃ©'],
      datasets: [{
        label: 'Services',
        data: [{{ services_planifie }}, {{ services_en_cours }}, {{ services_termine }}],
        backgroundColor: ['#f39c12','#3498db','#2ecc71']
      }]
    },
    options: {
      scales: { y: { beginAtZero:true } },
      plugins: { legend: { display: false } },
      responsive: true,
      maintainAspectRatio: false
    }
  });
</script>

<!-- ====== STYLES ====== -->
<style>
:root {
  --primary-yellow: #ffc107;
  --primary-blue: #0d1b2a;
  --bg-white: #ffffff;
  --text-dark: #1a1a2e;
  --shadow-light: 0 4px 20px rgba(0,0,0,0.08);
  --shadow-hover: 0 8px 25px rgba(0,0,0,0.12);
  --radius: 15px;
}

/* ====== CONTAINER ====== */
.dashboard-container {
  max-width: 1200px;
  margin: 40px auto;
  padding: 20px;
  background: #f9fafc;
  border-radius: var(--radius);
}

/* TITRE */
.dashboard-title {
  font-size: 2rem;
  font-weight: 700;
  color: var(--primary-blue);
  text-align: center;
  margin-bottom: 1.5rem;
}

/* CARDS SECTION */
.dashboard-cards {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
  margin-bottom: 30px;
}
.dash-card {
  flex: 1 1 300px;
  max-width: 320px;
  padding: 25px 20px;
  background: var(--bg-white);
  border-radius: var(--radius);
  box-shadow: var(--shadow-light);
  text-align: center;
  transition: transform 0.3s, box-shadow 0.3s;
}
.dash-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}
.dash-card h3 {
  color: var(--primary-blue);
  font-weight: 600;
  margin-top: 12px;
  font-size: 1.1rem;
}
.dash-card p {
  font-size: 1.6rem;
  font-weight: bold;
  color: var(--text-dark);
  margin-top: 5px;
}

/* ICONES (plus petites et centrÃ©es) */
.card-icon {
  font-size: 1.1rem;
  width: 34px;
  height: 34px;
  line-height: 34px;
  border-radius: 50%;
  color: #fff;
  margin: 0 auto 10px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.bg-warning { background-color: var(--primary-yellow) !important; color: #0d1b2a; }
.bg-primary { background-color: var(--primary-blue) !important; }
.bg-success { background-color: #2ecc71 !important; }

/* SEPARATEUR */
.divider {
  border: 0;
  height: 1px;
  background: #e0e0e0;
  margin: 2rem 0;
}

/* GRAPHIQUES */
.charts-container {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
}
.chart-box {
  flex: 1 1 450px;
  background: var(--bg-white);
  padding: 1.5rem;
  border-radius: var(--radius);
  box-shadow: var(--shadow-light);
  transition: box-shadow 0.3s;
}
.chart-box:hover {
  box-shadow: var(--shadow-hover);
}
.chart-box h2 {
  font-size: 1.2rem;
  color: var(--primary-blue);
  margin-bottom: 1rem;
  text-align: center;
}
canvas {
  width: 100%;
  height: 320px !important;
  display: block;
}

/* ====== RESPONSIVE ====== */
@media (max-width: 992px) {
  .dashboard-title { font-size: 1.8rem; }
  .dash-card { flex: 1 1 45%; }
  .chart-box { flex: 1 1 100%; }
}
@media (max-width: 768px) {
  .dashboard-container { margin: 20px; padding: 15px; }
  .dash-card { flex: 1 1 100%; }
  canvas { height: 280px !important; }
}
@media (max-width: 480px) {
  .dashboard-title { font-size: 1.5rem; }
  .dash-card p { font-size: 1.3rem; }
  .card-icon { width: 30px; height: 30px; font-size: 0.9rem; }
  .chart-box { padding: 1rem; }
}
</style>
{% endblock %}
