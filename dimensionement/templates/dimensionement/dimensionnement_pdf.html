{# tlmt/dimensionnement/templates/dimensionnement_pdf.html #}

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Rapport de dimensionnement PV</title>
  {% load static %}
  <style>
    /* =================
       Couleurs & Thème
       ================= */
:root {
  --primary-yellow: #ffcc00;
  --primary-blue: #1a2b4c;
  --bg-light: #f8f9fb;
  --text-dark: #333;
  --muted: #6b7280;
  --line: #e5e7eb;
  --card: #ffffff;
  --radius: 12px;
}

/* =================
   Page & Texte
   ================= */
@page {
  size: A4;
  margin: 18mm 16mm 20mm 16mm;
}

html, body {
  margin: 0;
  padding: 0;
  font: 13px/1.5 "Poppins", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Helvetica, Arial, sans-serif;
  background-color: var(--bg-light);
  color: var(--text-dark);
  -webkit-print-color-adjust: exact;
  print-color-adjust: exact;
}

h1,h2,h3 {
  margin: 0 0 6px 0;
  font-weight: 700;
  line-height: 1.2;
  color: var(--primary-blue);
}

h1.title {
  font-size: 22px;
}

h2.section-title {
  font-size: 15px;
  margin-bottom: 8px;
  padding-left: 10px;
  border-left: 4px solid var(--primary-yellow);
}

/* =================
   Header
   ================= */
.doc-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 16px;
  margin-bottom: 12px;
}

.header-left .subtitle {
  margin: 6px 0 2px 0;
}

.muted { color: var(--muted); }
.small { font-size: 12px; }

.header-right .logo {
  height: 50px;
  object-fit: contain;
}

.divider {
  height: 1px;
  border: 0;
  background: var(--line);
  margin: 10px 0 14px 0;
}

/* =================
   Sections & Cards
   ================= */
.section {
  margin-bottom: 14px;
}

.card {
  background: var(--card);
  border: 1px solid var(--line);
  border-radius: var(--radius);
  padding: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}

/* =================
   Tables Modernes
   ================= */
.table {
  width: 100%;
  border-collapse: collapse;
}

.table thead th {
  background: var(--primary-blue);
  color: #fff;
  font-weight: 600;
  font-size: 13px;
  text-align: center;
  border-bottom: 2px solid var(--primary-yellow);
  padding: 8px 6px;
  border-radius: var(--radius)  var(--radius) 0 0;
}

.table tbody td,
.table tbody th {
  border-top: 1px solid var(--line);
  padding: 8px 6px;
  text-align: center;
  vertical-align: middle;
  font-size: 12.5px;
}

.table .left { text-align: left; }

.table-kv th {
  width: 50%;
  text-align: left;
  background: #f3f4f6;
}

.table-kv td {
  text-align: left;
}

.table-lined tbody tr:nth-child(even) {
  background: #fafafa;
}

.badge {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 999px;
  border: 1px solid var(--primary-blue);
  color: var(--primary-blue);
  background: #e0f2fe;
  font-weight: 600;
  font-size: 12.5px;
}

/* =================
   Footer
   ================= */
.doc-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  border-top: 1px solid var(--line);
  margin-top: 14px;
  padding-top: 8px;
  font-size: 12px;
  color: var(--muted);
}

.page-number .page::after {
  content: counter(page);
}
.page-number .pages::after {
  content: counter(pages);
}

/* Impression */
@media print {
  * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    color-adjust: exact !important;
  }
}
  </style>
</head>
<body>

  <!-- ===== HEADER ===== -->
  <header class="doc-header">
    <div class="header-left">
      <h1 class="title">Rapport de dimensionnement photovoltaïque</h1>
      <p class="subtitle">
        <span class="label">Client :</span>
        <strong>{{ demande.nom }}</strong>
        — {{ demande.email }}
        {% if demande.telephone %} — {{ demande.telephone }}{% endif %}
      </p>
      <p class="muted small">Généré le {{ demande.created_at|date:"d/m/Y H:i" }}</p>
    </div>
    <div class="header-right">
      <img src="file://{{ logo_path }}" alt="Logo" class="logo">
    </div>
  </header>

  <hr class="divider">

  <!-- ===== ENTRÉES ===== -->
  <section class="section">
    <h2 class="section-title">Entrées</h2>
    <div class="card">
      <table class="table table-kv">
        <thead>
          <tr>
            <th>Jours d’autonomie</th>
            <th>Irradiation (kWh/m²·j)</th>
            <th>Coefficient K</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="badge">{{ demande.jours_autonomie }}</span></td>
            <td><span class="badge">{{ demande.irradiation }}</span></td>
            <td><span class="badge">{{ demande.rendement_k }}</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  {% if details %}
  <!-- ===== APPAREILS SAISIS ===== -->
  <section class="section">
    <h2 class="section-title">Appareils saisis</h2>
    <div class="card">
      <table class="table table-lined table-compact">
        <thead>
          <tr>
            <th>#</th>
            <th class="left">Nom</th>
            <th>Puissance (W)</th>
            <th>Durée (h/j)</th>
            <th>Quantité</th>
            <th>Énergie (Wh/j)</th>
          </tr>
        </thead>
        <tbody>
          {% for d in details %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td class="left">{{ d.nom|default:"—" }}</td>
            <td>{{ d.puissance }}</td>
            <td>{{ d.duree }}</td>
            <td>{{ d.quantite }}</td>
            <td>{{ d.wh|floatformat:2 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
  {% endif %}

  <!-- ===== RÉSULTATS ===== -->
  <section class="section">
    <h2 class="section-title">Résultats & Choix d’équipements</h2>
    <div class="card">
      <table class="table table-kv">
        <tbody>
          <tr>
            <th>Énergie journalière (Ec)</th>
            <td><strong>{{ demande.energie_journaliere|floatformat:2 }}</strong> Wh/j</td>
          </tr>
          <tr>
            <th>Tension système</th>
            <td><strong>{{ demande.tension_systeme|floatformat:0 }}</strong> VDC</td>
          </tr>
          <tr>
            <th>Puissance onduleur (≈ ΣP × 1.5)</th>
            <td><strong>{{ demande.puissance_onduleur|floatformat:2 }}</strong> VA</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- ===== PROPOSITIONS PV ===== -->
  <section class="section">
    <h2 class="section-title">Propositions de panneaux</h2>
    <div class="card">
      <table class="table table-lined table-compact">
        <thead>
          <tr>
            <th>Taille panneau</th>
            <th>Quantité</th>
          </tr>
        </thead>
        <tbody>
          {% for p in propositions_pv %}
          <tr>
            <td>{{ p.w }} W</td>
            <td>{{ p.qty }} × ({{ p.w }}W)</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- ===== PROPOSITIONS BATTERIES ===== -->
  <section class="section">
    <h2 class="section-title">Propositions de batteries</h2>
    <div class="card">
      <table class="table table-lined table-compact">
        <thead>
          <tr>
            <th>Capacité batterie</th>
            <th>Quantité</th>
          </tr>
        </thead>
        <tbody>
          {% for b in propositions_batt %}
          <tr>
            <td>{{ b.ah }} Ah</td>
            <td>{{ b.qty }} × ({{ b.ah }}Ah)</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- ===== NOTE ===== -->
  <section class="section">
    <p class="muted small">
      <strong>Remarque :</strong> Les propositions sont arrondies au supérieur. Le choix réel dépend du stock,
      des montages série/parallèle et des contraintes d’installation.
    </p>
  </section>

  <!-- ===== FOOTER ===== -->
  <footer class="doc-footer">
    <span class="muted">Rapport de dimensionnement • {{ demande.nom }}</span>
    <span class="page-number">Page <span class="page"></span> / <span class="pages"></span></span>
  </footer>

</body>
</html>
