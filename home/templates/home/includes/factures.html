{% comment %} templates/facture.html {% endcomment %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Facture — {{ commande.numero_facture }}</title>

  <style>
/* =================
   Couleurs & Thème
   ================= */
body {
  margin: 0;
  padding: 0;
  font: 14px/1.5 "Poppins", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Helvetica, Arial, sans-serif;
  background-color: #f8f9fb; /* var(--bg-light) */
  color: #111827; /* var(--text-dark) */
}

h1,h2,h3,h4,h5,h6 {
  margin: 0 0 6px 0;
  font-weight: 700;
  line-height: 1.2;
  color: #1a2b4c; /* var(--primary-blue) */
}

.invoice-wrapper {
  max-width: 920px;
  margin: 20px auto;
}

.invoice {
  background: #ffffff; /* var(--card) */
  border-radius: 12px; /* var(--radius) */
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}

.invoice-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 16px;
  margin-bottom: 12px;
}

.invoice-logo {
  height: 60px;
  width: 60px;
  object-fit: contain;
  border-radius: 12px; /* var(--radius) */
  background: #fff;
  padding: 4px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}

.header-left .subtitle,
.header-left .muted {
  font-size: 13px;
  color: #6b7280; /* var(--muted) */
}

.text-end {
  text-align: right;
}

/* Tables Modernes */
.table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 14px;
}

.table thead th {
  background: #1a2b4c; /* var(--primary-blue) */
  color: #fff;
  font-weight: 600;
  font-size: 13px;
  text-align: center;
  border-bottom: 2px solid #ffcc00; /* var(--primary-yellow) */
  padding: 8px 6px;
}

.table tbody td {
  border-top: 1px solid #e5e7eb; /* var(--line) */
  padding: 8px 6px;
  text-align: center;
  vertical-align: middle;
  font-size: 13px;
}

.table .left { text-align: left; }

.badge {
  display: inline-block;
  padding: 3px 10px;
  border-radius: 999px;
  border: 1px solid #1a2b4c; /* var(--primary-blue) */
  color: #1a2b4c; /* var(--primary-blue) */
  background: #e0f2fe;
  font-weight: 600;
  font-size: 12px;
}

/* Totaux */
.totals-row {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  margin-top: 8px;
}

.totals-row div {
  display: flex;
  justify-content: space-between;
  width: 220px;
  font-size: 14px;
}

.totals-row .total {
  font-weight: 700;
  color: #1a2b4c; /* var(--primary-blue) */
  font-size: 16px;
}

/* Note & footer */
.invoice-note {
  background: #fbfbff;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #f0f4ff;
  font-size: 13px;
  color: #6b7280; /* var(--muted) */
  margin-top: 12px;
}

.invoice-footer {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: #6b7280; /* var(--muted) */
  margin-top: 14px;
  border-top: 1px solid #e5e7eb; /* var(--line) */
  padding-top: 8px;
}

/* Impression */
@media print {
  body { background:#fff; }
  .invoice { box-shadow:none; border-radius:0; }
  a[href]:after { content: ""; }
}
</style>

</head>
<body>
  <div class="invoice-wrapper">
    <div class="invoice">

      <!-- Header : logo + infos entreprise et facture -->
      <div class="invoice-header">
        <div class="header-left">
          {% if entreprise and entreprise.logo_url %}
            <img src="{{ entreprise.logo_url }}" alt="Logo" class="invoice-logo">
          {% else %}
            <div class="invoice-logo" style="display:flex;align-items:center;justify-content:center;background:var(--primary-blue);color:#fff;font-weight:700;font-size:20px;">ZARA</div>
          {% endif %}
          <h1 class="invoice-title">FACTURE</h1>
          <div class="subtitle">{{ entreprise.nom|default:"Zara Store" }}</div>
          <div class="subtitle">{{ entreprise.adresse|default:"Adresse de l'entreprise" }}</div>
          <div class="subtitle">T: {{ entreprise.telephone|default:"—" }}</div>
        </div>

        <div class="text-end">
          <div class="fw-semibold">N° {{ commande.numero_facture }}</div>
          <div class="subtitle">Date : {{ commande.date_commande }}</div>
          {% if commande.echeance %}
            <div class="subtitle">Échéance : {{ commande.echeance }}</div>
          {% endif %}

          {% if commande.statut == "Payée" %}
            <div class="badge bg-success">{{ commande.statut }}</div>
          {% elif commande.statut == "En attente" %}
            <div class="badge bg-warning">{{ commande.statut }}</div>
          {% else %}
            <div class="badge bg-secondary">{{ commande.statut }}</div>
          {% endif %}
        </div>
      </div>

      <hr>

      <!-- Client & résumé -->
      <div class="row mb-3">
        <div class="col-md-6">
          <h6 class="section-title">Facturer à :</h6>
          <div class="fw-semibold">{{ commande.client.nom }}</div>
          <div class="muted">{{ commande.client.adresse }}</div>
          <div class="muted">T: {{ commande.client.telephone }}</div>
          {% if commande.client.email %}
            <div class="muted">{{ commande.client.email }}</div>
          {% endif %}
        </div>

        <div class="col-md-6 text-end mt-3 mt-md-0">
          <h6 class="section-title">Résumé</h6>
          <div>Mode paiement : <strong>{{ commande.mode_paiement|default:"—" }}</strong></div>
        </div>
      </div>

      <!-- Table lignes -->
      <div class="table-responsive mb-3">
        <table class="table table-borderless align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>Désignation</th>
              <th>Qté</th>
              <th>PU</th>
              <th>Remise</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            {% for ligne in items %}
              <tr>
                <td>{{ forloop.counter }}</td>
                <td class="left">
                  <div class="fw-semibold">{{ ligne.produit.nom }}</div>
                </td>
                <td>{{ ligne.quantite }}</td>
                <td>{{ ligne.prix_unitaire|floatformat:2 }}</td>
                <td>0</td>
                <td class="fw-semibold">{{ ligne.prix_unitaire|floatformat:2|floatformat:"2" }}</td>
              </tr>
            {% empty %}
              <tr><td colspan="6" class="text-center muted py-4">Aucune ligne</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="totals-row flex-column align-items-end">
        <div class="total"><span>Total à payer</span><span>{{ total|floatformat:2 }} Ar</span></div>
      </div>

      <div class="invoice-note mt-4">
        <div class="muted">Merci pour votre confiance.</div>
      </div>

      <div class="invoice-footer mt-4">
        <div>Émis par : {{ request.user.get_full_name|default:"TLMT Services" }}</div>
        <div>Contact : {{ entreprise.email|default_if_none:entreprise.telephone|default:"033 60 361 71" }}</div>
      </div>

    </div>
  </div>
</body>
</html>
