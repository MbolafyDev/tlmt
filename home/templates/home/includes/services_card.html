{% load static %}

<div class="col-md-9">
  <h3>Nos Services & Travaux Réalisés</h3>
  <div class="row g-4 d-flex align-items-stretch">
    {% for service in services %}
    <div class="col-sm-6 col-md-6 col-lg-4">
      <div class="card h-100 d-flex flex-column position-relative shadow-sm border-0 rounded-4 overflow-hidden transition-card">

        <!-- Badge statut -->
        {% with statut_display=service.get_statut_display %}
          {% if statut_display %}
            <span class="badge position-absolute top-0 end-0 m-3 px-3 py-2 fs-6
              {% if statut_display == "Planifié" %}bg-warning{% elif statut_display == "En cours" %}bg-secondary{% elif statut_display == "Terminé" %}bg-success{% endif %}">
              {{ statut_display }}
            </span>
          {% endif %}
        {% endwith %}

        <!-- Image -->
        <div class="p-3 text-center bg-light">
          {% if service.images.exists %}
            <img src="{{ service.images.first.image.url }}" alt="{{ service.titre }}" class="img-card mx-auto rounded-3 shadow-sm">
          {% else %}
            <img src="{% static 'images/default.png' %}" alt="{{ service.titre }}" class="img-card mx-auto rounded-3 shadow-sm">
          {% endif %}
        </div>

        <!-- Détails -->
        <div class="card-body d-flex flex-column flex-grow-1 justify-content-between">
          <h5 class="card-title mt-2 fw-bold text-truncate">{{ service.titre }}</h5>
          <p class="card-text text-muted mb-2">
            {% if service.description %}
              {% if service.description|length > 50 %}
                {{ service.description|safe|slice:":50" }}...
              {% else %}
                {{ service.description|safe }}
              {% endif %}
              <a href="#" class="voir-plus-service" data-service-id="{{ service.id }}">Voir plus</a>
            {% else %}
              Aucune description disponible.
            {% endif %}
          </p>

          {% if user.is_authenticated %}
          <div class="d-flex gap-2 mt-2">
            <button class="btn btn-outline-secondary btn-like btn-sm hover-scale" data-service-id="{{ service.id }}">
              <i class="fas fa-thumbs-up"></i>
              <span class="like-count">{{ service.likes_count }}</span>
            </button>
            <button class="btn btn-outline-primary btn-comment btn-sm hover-scale" data-service-id="{{ service.id }}" data-bs-toggle="modal" data-bs-target="#commentModal">
              <i class="fas fa-comment"></i>
              <span class="comment-count">{{ service.comments_count }}</span>
            </button>
          </div>
          {% endif %}
        </div>

      </div>
    </div>
    {% endfor %}
  </div>
</div>

<style>
/* ====== Style carte service comme produit ultra moderne ====== */
.transition-card {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.transition-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 30px rgba(0,0,0,0.15);
}

.img-card {
  max-width: 100%;
  max-height: 180px;
  object-fit: contain; /* Flexible, pas de rognage */
  transition: transform 0.3s ease;
}

.img-card:hover {
  transform: scale(1.05);
}

.hover-scale {
  transition: transform 0.2s ease;
}

.hover-scale:hover {
  transform: scale(1.1);
}

.card-title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.card-text {
  font-size: 0.9rem;
}

.card .badge {
  font-weight: 600;
}

.btn-like, .btn-comment {
  border-width: 2px;
  border-radius: 50px;
}
</style>
