{# tlmt/templates/base.html #}
{% load static %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{% endblock title %}</title>
    {% block extra_head %}{% endblock extra_head %}

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Feuilles de style projet -->
    <link rel="stylesheet" href="{% static 'css/carousel.css' %}">
    <link rel="stylesheet" href="{% static 'css/card-produit.css' %}">
    <link rel="stylesheet" href="{% static 'css/img.css' %}">
    {% block extra_css %}{% endblock extra_css %}

    <!-- PWA -->
    <link rel="manifest" href="{% url 'manifest' %}">
    <meta name="theme-color" content="#f9fd0dff">
    <link rel="apple-touch-icon" href="{% static 'pwa/icons/icon-192.png' %}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <style>
        body { padding-top: 60px; }
        .container-fluid { flex-wrap: nowrap; }
        .card { border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); transition: transform 0.3s, box-shadow 0.3s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.12); }
        footer { background: #f8f9fa; padding: 3rem 1rem; color: #333; }
        footer a { color: #333; transition: 0.2s; }
        footer a:hover { color: #ffcc00; text-decoration: none; }
    </style>
</head>
<body>
<noscript>
    <div class="alert alert-warning text-center m-0">
        JavaScript est désactivé ; certaines fonctionnalités ne fonctionneront pas.
    </div>
</noscript>

<!-- ================= NAVBAR ================= -->
{% include 'includes/nav.html' %}

<!-- ================= CONTENU ================= -->
<main id="main" class="flex-shrink-0">
    {% block content %}{% endblock content %}
</main>

<!-- ================= FOOTER ================= -->
{% include 'includes/footer.html' %}

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>

<!-- Service Worker -->
<script>
(function() {
    if (!("serviceWorker" in navigator)) return;
    window.addEventListener("load", function () {
        const swUrl = "{% url 'service_worker_root' %}";
        navigator.serviceWorker.register(swUrl)
            .then(function(reg) {
                reg.addEventListener("updatefound", function () {
                    const newSW = reg.installing;
                    if (!newSW) return;
                    newSW.addEventListener("statechange", function () {
                        if (newSW.state === "installed" && navigator.serviceWorker.controller) {
                            console.log("Mise à jour PWA disponible.");
                            reg.waiting && reg.waiting.postMessage("SKIP_WAITING");
                        }
                    });
                });
                navigator.serviceWorker.addEventListener("controllerchange", function () {
                    if (!window.__sw_refresh_done) {
                        window.__sw_refresh_done = true;
                        window.location.reload();
                    }
                });
            })
            .catch(function(err) {
                console.error("Échec d'enregistrement du Service Worker:", err);
            });
    });
})();
</script>

{% block extra_js %}{% endblock extra_js %}
</body>
</html>
