{% load static %}

<style>
/* Navbar icônes */
.navbar-nav .nav-item {
    margin-right: 8px;
}

.navbar-nav .nav-link {
    padding: 5px 8px;
    font-size: 1.4rem;
    position: relative;
}

.navbar-brand {
    padding: 0;
}

/* Champ recherche dropdown (desktop) */
#searchDropdown {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    width: 125px;
    padding: 2px 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    background-color: white;
    z-index: 1000;
}

#searchDropdown input {
    width: 100%;
    border: none;
    outline: none;
    padding: 2px 4px;
}

/* Sidebar mobile */
#mobileSidebar {
    position: fixed;
    top: 0;
    left: -250px;
    height: 100%;
    width: 250px;
    background-color: #fff;
    box-shadow: 2px 0 5px rgba(0,0,0,0.3);
    z-index: 1050;
    transition: left 0.3s ease;
    padding-top: 60px;
}

#mobileSidebar .close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 1.5rem;
    cursor: pointer;
}

#mobileSidebar ul li {
    text-align: left;
    padding: 12px 20px;
}

#mobileSidebar ul li a {
    text-decoration: none;
    color: #333;
    display: block;
}

#mobileSidebar ul li a i {
    margin-right: 8px;
}

/* Sous-menu mobile */
#mobileSidebar .submenu {
    list-style: none;
    padding-left: 0;
    display: none;
}
#mobileSidebar .submenu li a {
    padding-left: 20px;
    font-size: 1.2rem; /* réduit par rapport au menu principal */
}

/* Overlay */
#sidebarOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    z-index: 1040;
    display: none;
}

/* Active state */
#mobileSidebar.active {
    left: 0;
}

#sidebarOverlay.active {
    display: block;
}

/* Responsive adjustments */
@media(max-width: 991px){
    #navbarIcons {
        display: none !important;
    }

    #searchDropdown {
        width: 100%;
        left: 0;
        right: 0;
        top: auto;
        margin-top: 5px;
    }
}
</style>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">

    <!-- Logo -->
    <a class="navbar-brand" href="{% url '/home' %}">
      <img src="{% static 'images/logo.jpg' %}" alt="Logo TLMT" width="40">
    </a>

    <!-- Toggle mobile sidebar -->
    <button class="btn d-lg-none" id="mobileMenuBtn">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Navbar icons (desktop) -->
    <div class="collapse navbar-collapse justify-content-end" id="navbarIcons">
      <ul class="navbar-nav align-items-center">

        <!-- Recherche -->
        <li class="nav-item position-relative">
          <a class="nav-link" href="#" id="searchIcon" data-bs-toggle="tooltip" title="Recherche">
            <i class="fas fa-search"></i>
          </a>
          <div id="searchDropdown">
            <input type="text" placeholder="Rechercher...">
          </div>
        </li>

        <!-- Shopping Cart -->
        <li class="nav-item">
          <a class="nav-link position-relative" href="#" data-bs-toggle="tooltip" title="Panier">
            <i class="fas fa-shopping-cart"></i>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
          </a>
        </li>

        <!-- Services Dropdown -->
        <li class="nav-item dropdown">
          <a class="nav-link" href="#" id="servicesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" title="Services">
            <i class="fas fa-puzzle-piece"></i>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="servicesDropdown">
            <li><a class="dropdown-item" href="#"><i class="fas fa-tools"></i> Installation</a></li>
            <li><a class="dropdown-item" href="#"><i class="fas fa-hand-holding-usd"></i> Ventes</a></li>
            <li><a class="dropdown-item" href="#"><i class="fas fa-file-invoice"></i> Devis</a></li>
            <li><a class="dropdown-item" href="{% url 'demande_dimensionnement' %}"><i class="fas fa-bolt"></i> Dimensionnement Paneau Solaire</a></li>
          </ul>
        </li>

        <!-- Contacter-nous -->
        <li class="nav-item">
          <a class="nav-link" href="#" data-bs-toggle="tooltip" title="Contacter-nous">
            <i class="fas fa-envelope"></i>
          </a>
        </li>

        <!-- À propos -->
        <li class="nav-item">
          <a class="nav-link" href="{% url 'apropos' %}" data-bs-toggle="tooltip" title="À propos">
            <i class="fas fa-info-circle"></i>
          </a>
        </li>

        <!-- Utilisateur connecté / non -->
        {% if user.is_authenticated %}
          <li class="nav-item dropdown">
            <a class="nav-link" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" title="Utilisateur">
              <i class="fas fa-user"></i>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
              <li><a class="dropdown-item" href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> Déconnexion</a></li>
            </ul>
          </li>
        {% else %}
          <li class="nav-item">
            <a class="nav-link" href="{% url 'login' %}" title="Connexion"><i class="fas fa-sign-in-alt"></i></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'register' %}" title="Inscription"><i class="fas fa-user-plus"></i></a>
          </li>
        {% endif %}

      </ul>
    </div>
  </div>
</nav>

<!-- Sidebar mobile -->
<div id="mobileSidebar">
  <!-- Bouton fermer -->
  <span class="close-btn" id="closeSidebarBtn">&times;</span>
  <ul class="mobile-menu list-unstyled">
    <li><a href="#"><i class="fas fa-search"></i> Recherche</a></li>
    <li><a href="#"><i class="fas fa-shopping-cart"></i> Panier <span class="badge bg-danger">0</span></a></li>
    
    <!-- Services avec sous-menu -->
    <li>
      <a href="#" class="submenu-toggle"><i class="fas fa-puzzle-piece"></i> Services <i class="fas fa-caret-down float-end"></i></a>
      <ul class="submenu list-unstyled" >
        <li><a href="#" style="font-size: 12px; padding: 0; margin: 0;"><i class="fas fa-tools"></i> Installation</a></li>
        <li><a href="#" style="font-size: 12px; padding: 0; margin: 0;"><i class="fas fa-hand-holding-usd"></i> Ventes</a></li>
        <li><a href="#" style="font-size: 12px; padding: 0; margin: 0;"><i class="fas fa-file-invoice"></i> Devis</a></li>
        <li><a href="{% url 'demande_dimensionnement' %}" style="font-size: 12px; padding: 0; margin: 0;"><i class="fas fa-bolt"></i> Dimensionnement Paneau Solaire</a></li>
      </ul>
    </li>

    <li><a href="#"><i class="fas fa-envelope"></i> Contacter-nous</a></li>
    <li><a href="{% url 'apropos' %}"><i class="fas fa-info-circle"></i> À propos</a></li>
    {% if user.is_authenticated %}
      <li><a href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> Déconnexion</a></li>
    {% else %}
      <li><a href="{% url 'login' %}"><i class="fas fa-sign-in-alt"></i> Connexion</a></li>
      <li><a href="{% url 'register' %}"><i class="fas fa-user-plus"></i> Inscription</a></li>
    {% endif %}
  </ul>
</div>

<!-- Overlay -->
<div id="sidebarOverlay"></div>

<!-- Bootstrap Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Tooltips
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
  return new bootstrap.Tooltip(tooltipTriggerEl)
});

// Toggle input recherche (desktop)
var searchIcon = document.getElementById('searchIcon');
var searchDropdown = document.getElementById('searchDropdown');

searchIcon.addEventListener('click', function(e){
    e.preventDefault();
    if(searchDropdown.style.display === 'block'){
        searchDropdown.style.display = 'none';
    } else {
        searchDropdown.style.display = 'block';
        searchDropdown.querySelector('input').focus();
    }
});

// Clic hors pour fermer la recherche
document.addEventListener('click', function(e){
    if(!searchDropdown.contains(e.target) && !searchIcon.contains(e.target)){
        searchDropdown.style.display = 'none';
    }
});

// Sidebar mobile toggle
const mobileBtn = document.getElementById('mobileMenuBtn');
const mobileSidebar = document.getElementById('mobileSidebar');
const overlay = document.getElementById('sidebarOverlay');
const closeSidebarBtn = document.getElementById('closeSidebarBtn');

mobileBtn.addEventListener('click', function(){
    mobileSidebar.classList.add('active');
    overlay.classList.add('active');
});

overlay.addEventListener('click', function(){
    mobileSidebar.classList.remove('active');
    overlay.classList.remove('active');
});

closeSidebarBtn.addEventListener('click', function(){
    mobileSidebar.classList.remove('active');
    overlay.classList.remove('active');
});

// Toggle sous-menu mobile
const submenuToggles = document.querySelectorAll('.submenu-toggle');
submenuToggles.forEach(function(toggle){
    toggle.addEventListener('click', function(e){
        e.preventDefault();
        const submenu = this.nextElementSibling;
        if(submenu.style.display === 'block'){
            submenu.style.display = 'none';
        } else {
            submenu.style.display = 'block';
        }
    });
});
</script>
